generator client {
  provider   = "prisma-client"
  output     = "../src/generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model Production {
  id              String      @id @default(cuid())
  produitId       String
  stock_initial   Int?
  date_production DateTime    @default(now())
  observation     String?
  mouvements      Mouvement[]
  produit         Produit     @relation(fields: [produitId], references: [id])
}

model Categorie {
  id             String    @id @default(cuid())
  nom            String
  date_categorie DateTime  @default(now())
  designation    String?
  produit        Produit[]
}

model Produit {
  id            String       @id @default(cuid())
  nom           String
  unite         String?      @default("")
  categorieId   String
  stock_initial Int?
  seuil_minimum Int?
  nombre_bars   Int?
  prix          Float?
  devise        String?     @default("")
  stockTotal    Int?
  date_creation DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  ligneVente    LigneVente[]
  mouvements    Mouvement[]
  productions   Production[]
  categorie     Categorie    @relation(fields: [categorieId], references: [id])
}

model Mouvement {
  id             String        @id @default(cuid())
  produitId      String?
  unite          String?
  productionId   String?
  emballageOpId  String?
  date_mouvement DateTime      @default(now())
  type           TypeMouvement
  quantite       Int
  observation    String?
  updatedAt      DateTime      @updatedAt
  production     Production?   @relation(fields: [productionId], references: [id], onDelete: Cascade)
  produit        Produit?      @relation(fields: [produitId], references: [id], onDelete: Cascade)
}

model Utilisateur {
  id              String    @id @default(cuid())
  name            String    @default("")
  postnom         String    @default("")
  prenom          String    @default("")
  pays            String    @default("")
  ville           String    @default("")
  commune         String    @default("")
  Etatcivil       String    @default("CÃ©libataire")
  numerotelephone String    @default("")
  email           String    @unique
  password        String
  role            Role      @default(caissier)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  expense         Expense[]
  vente           Vente[]
}

model Rubrique {
  id        String    @id @default(cuid())
  name      String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  expenses  Expense[]
}

model Expense {
  id            String       @id @default(cuid())
  libelle       String?
  beneficiaire  String?
  amount        Float
  date          DateTime     @default(now())
  utilisateurId String?
  rubriqueId    String?
  devise        String?
  fournisseur   String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  rubrique      Rubrique?    @relation(fields: [rubriqueId], references: [id])
  utilisateur   Utilisateur? @relation(fields: [utilisateurId], references: [id])
}

model Vente {
  id            String       @id @default(cuid())
  dateVente     DateTime     @default(now())
  clientId      String
  total         Float        @default(0)
  utilisateurId String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  ligneVente    LigneVente[]
  client        Client       @relation(fields: [clientId], references: [id])
  utilisateur   Utilisateur? @relation(fields: [utilisateurId], references: [id])
}

model LigneVente {
  id           String  @id @default(cuid())
  produitId    String
  quantite     Int
  prixUnitaire Float
  sousTotal    Float
  venteId      String
  produit      Produit @relation(fields: [produitId], references: [id])
  vente        Vente   @relation(fields: [venteId], references: [id])
}

model Client {
  id      String  @id @default(cuid())
  nom     String
  contact String?
  ventes  Vente[]
}

enum Role {
  admin
  caissier
  magasinier
  comptable
}

enum CategorieProduit {
  PRODUIT_FINI
  EMBALLAGE
}

enum TypeMouvement {
  ENTREE
  SORTIE
  ANNULATION_VENTE
}
